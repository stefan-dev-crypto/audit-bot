Contract Address: 0x93054188d876f558f4a66b2ef1d97d16edf0895b
Source File: 119_0x93054188d876f558f4a66b2ef1d97d16edf0895b.sol
Audit Date: 2026-01-15T15:23:35.364Z
Model: gpt-4.1

================================ AUDIT RESULT ================================

Critical Vulnerability: ðŸš¨ YES

Summary:
The contract is a Curve-style stableswap pool for two tokens (e.g., renBTC/wBTC), supporting swapping, adding/removing liquidity, and utilizing lending protocols for one of the tokens. Several critical user-exploitable issues are present. Key vulnerabilities include potential for reentrancy via token hooks if underlying ERC20s are malicious, lack of input validation on indices, issues with lending rate manipulation for pricing attacks, rounding and precision edge cases causing fund loss, and lack of pool invariant protection during _exchange and withdrawal calculations. Business logic flaws include imprecise fee/taxation for flash deposits, possible negative balances via withdrawal/imbalance, and imbalances in swap fairness. Arbitrary user-triggered manipulation of virtual pricing and, in the worst case, withdrawal of excessive value is possible. Flash loan-powered arbitrage against the pool's internal accounting is also feasible.


Critical Issues Found:

1. Potential pool loss from reentrancy in coin tokens
   Type: Reentrancy
   Function: add_liquidity,exchange,remove_liquidity,remove_liquidity_one_coin,remove_liquidity_imbalance
   
   Attack Scenario:
   If either coin in the pool or the pool token implements a malicious transferFrom/transfer/burnFrom that calls back into the pool contract, reentrancy may occur before balances are updated. For example, calling exchange() or add_liquidity() with a token that invokes remove_liquidity_one_coin in its transferFrom can allow for race conditions, draining funds or manipulating accounting.
   
   Impact:
   Draining of pool funds, manipulation of LP accounting, or bypassing balance consistency checks.
   
   Recommended Fix:
   undefined


2. Manipulation of cToken exchange rate (oracle-style manipulation)
   Type: External Price Oracle Manipulation
   Function: _rates,_xp,_xp_mem,get_virtual_price,exchange,add_liquidity,remove_liquidity_one_coin
   
   Attack Scenario:
   For the token that uses lending (e.g., cToken), a user can manipulate the cToken exchange rate within a single transaction if the cToken contract gives per-user control (e.g., markets with low liquidity). This can be done via mint/redeem interactions before and after swaps to skew the rate, affecting pool balance calculations (in _rates and downstream).
   
   Impact:
   Users can extract extra tokens from swaps, flash deposits, or liquidity removal by manipulating exchange rates in their favor. Possible profit cycles arise.
   
   Recommended Fix:
   undefined


3. No input validation on token indices (arbitrary reads)
   Type: Array Out-of-Bounds
   Function: exchange,get_dy,remove_liquidity_one_coin
   
   Attack Scenario:
   Functions like get_dy, exchange, remove_liquidity_one_coin, etc. accept arbitrary int128 values for index arguments 'i' and 'j' without explicit bounds checks. Malicious input could cause out-of-bounds reads/writes, possibly exploiting old compiler behaviors or edge-case bugs or reading privileged memory locations.
   
   Impact:
   Potential for contract misbehavior, denial of service, or loss/freeze of user funds.
   
   Recommended Fix:
   undefined


4. Inaccurate pool accounting may allow negative pool balances
   Type: Invariant Violation / Underflow
   Function: remove_liquidity,remove_liquidity_imbalance,remove_liquidity_one_coin
   
   Attack Scenario:
   Functions like remove_liquidity and remove_liquidity_imbalance simply subtract from self.balances[i] without ensuring there is enough underlying balance to cover requested amounts. Combined with rounding errors and flash loan attacks, negative accounting or actual token transfer failures may arise. Although the burnFrom operation can revert, underlying token transfer failures (ERC20 transfer returns false) may not revert pool state.
   
   Impact:
   Loss of funds, pool locked with negative balances, or shortfall for remaining users. Could allow draining more coins than intended.
   
   Recommended Fix:
   undefined


5. Lending pool cToken logic introduces a flash loan oracle risk
   Type: Lending Market Rate Manipulation (Oracle Risk)
   Function: _rates,exchange,add_liquidity,remove_liquidity_one_coin
   
   Attack Scenario:
   A user can borrow or repay a large cToken debt in the same block surrounding a trade to shift the 'exchangeRateCurrent' value, causing instant pool price manipulation. If the cToken is from a non-large pool, this introduces a classic flash loan profit cycle. The internal get_dy and virtual price calculations use instantaneous unverified exchange rates.
   
   Impact:
   Arbitrage profit for attacker, unfair loss for honest liquidity providers, or large losses if the pool is imbalanced as a result.
   
   Recommended Fix:
   undefined



==============================================================================
