Contract Address: 0xa751a143f8fe0a108800bfb915585e4255c2fe80
Source File: 106_0xa751a143f8fe0a108800bfb915585e4255c2fe80.sol
Audit Date: 2026-01-15T14:58:35.853Z
Model: gpt-4.1

================================ AUDIT RESULT ================================

Critical Vulnerability: ðŸš¨ YES

Summary:
The BPool contract (Balancer V1) exposes several critical vulnerabilities and business logic flaws exploitable by any unprivileged user. Notably, the contract is vulnerable to the ERC20 'transferFrom' with non-compliant tokens (potential for token theft or pool balance desynchronization), a broken join/exit invariant allowing pool draining with deflationary tokens, reentrancy risks on untrusted tokens (due to lack of checks-effects-interactions pattern), rounding and precision edge cases with small balances, and an unsafe 'gulp' function that allows griefing of pool share calculation. These issues can result in pool value loss, unfair pool share minting, or DoS.


Critical Issues Found:

1. ERC20 Non-compliance/Deflationary Token Exploit Allows Pool Drainage or Invariant Break
   Type: ERC20 compatibility / Invariant violation
   Function: joinPool,exitPool,swapExactAmountIn,swapExactAmountOut,_pullUnderlying,_pushUnderlying
   
   Attack Scenario:
   If any underlying pool token is a non-compliant ERC20 (with transfer or transferFrom not returning a boolean, having internal fees, or burning on transfer), the internal pool accounting is desynchronized. For example, with a deflationary token, 'joinPool' assumes the full requested amount is received, but the pool receives less. Attacker: 1. Supplies a deflationary token, 2. 'Joins' or 'swaps' in/out, 3. Receives fair pool tokens or output tokens based on an inflated balance, 4. Repeats to extract underlying value, draining the pool.
   
   Impact:
   Significant loss of pool assets, invariant break, pool shares become unbacked, full draining possible with continuous exploitation.
   
   Recommended Fix:
   undefined


2. Reentrancy via Malicious ERC20 Tokens in Pool Swaps or Exits
   Type: Reentrancy
   Function: joinPool,exitPool,swapExactAmountIn,swapExactAmountOut,_pullUnderlying,_pushUnderlying
   
   Attack Scenario:
   A malicious ERC20 token used as a pool asset can have reentrant code in transfer/transferFrom (e.g., calling back into the pool during _pullUnderlying or _pushUnderlying). Some functions update balances before external calls, but others do not follow strict checks-effects-interactions. Attacker could disrupt pool accounting or repeatedly trigger pool logic in an inconsistent state, bypassing max-in/out checks.
   
   Impact:
   Full loss of funds or draining of pool assets, especially if state is inconsistent mid-callback.
   
   Recommended Fix:
   undefined


3. Unsafe Gulp Function Allows Pool Ratio Manipulation (Dust Inflation Attack)
   Type: Pool share inflation / Value extraction
   Function: gulp
   
   Attack Scenario:
   Any user can call 'gulp' on a token, forcibly increasing the recorded balance to equal the full contract token balance (including any 'dust' sent by mistake or maliciously via direct transfer). Attacker sends excess tokens (dust) to the contract, calls 'gulp', pools with a small share, and receives more pool tokens than fair value, causing unfair dilution of other poolers.
   
   Impact:
   Unfair minting of pool shares, value extraction from existing poolers, possible manipulation of pool price and pool share ratios.
   
   Recommended Fix:
   undefined



==============================================================================
