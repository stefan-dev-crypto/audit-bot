Contract Address: 0x881d40237659c251811cec9c364ef91dc08d300c
Source File: 1_0x881d40237659c251811cec9c364ef91dc08d300c.sol
Audit Date: 2026-01-14T16:02:27.100Z
Model: gpt-4.1

================================ AUDIT RESULT ================================

Critical Vulnerability: ðŸš¨ YES

Summary:
General external users can execute arbitrary delegatecalls into adapters via Spender, potentially draining all ERC20, ERC721, and ETH held by the adapters or Spender contract itself, depending on what adapters are configured by the owner. This enables a critical fund-drain attack surface if a malicious or compromised adapter is enabled or if an adapter contains vulnerabilities.

Attack Surface: ETH, ERC20


Critical Issues Found:

1. Arbitrary delegatecall to adapter from Spender contract
   Type: Arbitrary delegatecall / Adapter code execution
   Function: Spender.swap() (and thus, MetaSwap._swap() and MetaSwap.swap())
   
   Attack Scenario:
   An attacker invokes MetaSwap.swap() (non-owner). After setup by the owner, attacker can choose arbitrary input to adapters. The Spender contract performs a delegatecall to the adapter contract with the adapter data and user-supplied call data (including attacker-controlled address as 'msg.sender'). If any adapter is insecure or malicious, or if the aggregatorId is configured to point to an adapter that performs unsafe operations, a delegatecall will execute in Spender's storage context, giving the adapter access to all token/ETH held by Spender. For example, a malicious adapter could execute code to drain all funds to an arbitrary address. This is possible for any general external user once owner sets up such an adapter. The same applies for any uncontrolled code execution in Adapter contracts.
   
   Impact:
   Complete theft of ERC20 tokens and ETH held by the Spender contract (and potentially other core funds depending on setup); adapter contracts (if holding assets) are also at risk. If the system is set up for general use (i.e., anyone can call swap), any user can trigger malicious adapter code, resulting in loss of all funds.
   
   Recommended Fix:
   Do not use delegatecall with untrusted adapters. Use standard external calls or carefully vetted staticcall/call. Only allow delegatecall to contracts that are strictly controlled and non-upgradeable. Consider passing data in a way that does not allow general arbitrary code execution via user input.



==============================================================================

Raw JSON:
{
  "critical_vulnerability_exists": true,
  "summary": "General external users can execute arbitrary delegatecalls into adapters via Spender, potentially draining all ERC20, ERC721, and ETH held by the adapters or Spender contract itself, depending on what adapters are configured by the owner. This enables a critical fund-drain attack surface if a malicious or compromised adapter is enabled or if an adapter contains vulnerabilities.",
  "attack_surface": [
    "ETH",
    "ERC20"
  ],
  "critical_issues": [
    {
      "title": "Arbitrary delegatecall to adapter from Spender contract",
      "vulnerability_type": "Arbitrary delegatecall / Adapter code execution",
      "affected_function": "Spender.swap() (and thus, MetaSwap._swap() and MetaSwap.swap())",
      "attack_scenario": "An attacker invokes MetaSwap.swap() (non-owner). After setup by the owner, attacker can choose arbitrary input to adapters. The Spender contract performs a delegatecall to the adapter contract with the adapter data and user-supplied call data (including attacker-controlled address as 'msg.sender'). If any adapter is insecure or malicious, or if the aggregatorId is configured to point to an adapter that performs unsafe operations, a delegatecall will execute in Spender's storage context, giving the adapter access to all token/ETH held by Spender. For example, a malicious adapter could execute code to drain all funds to an arbitrary address. This is possible for any general external user once owner sets up such an adapter. The same applies for any uncontrolled code execution in Adapter contracts.",
      "impact": "Complete theft of ERC20 tokens and ETH held by the Spender contract (and potentially other core funds depending on setup); adapter contracts (if holding assets) are also at risk. If the system is set up for general use (i.e., anyone can call swap), any user can trigger malicious adapter code, resulting in loss of all funds.",
      "recommended_fix": "Do not use delegatecall with untrusted adapters. Use standard external calls or carefully vetted staticcall/call. Only allow delegatecall to contracts that are strictly controlled and non-upgradeable. Consider passing data in a way that does not allow general arbitrary code execution via user input."
    }
  ]
}
